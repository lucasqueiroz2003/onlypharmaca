<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos - Only Pharma | Peptídios Premium</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- HEADER -->
    <header>
        <nav class="navbar">
            <a href="index.html" class="logo">
                <i class="fas fa-dna"></i>
                Only Pharma
            </a>
            <ul class="nav-menu">
                <li><a href="index.html">Início</a></li>
                <li><a href="produtos.html">Produtos</a></li>
                <li><a href="blog.html">Depoimentos</a></li>
                <li><a href="posts.html">Artigos</a></li>
                <li><a href="cadastro.html">Cadastro</a></li>
                <li><a href="admin.html">Admin</a></li>
                <li>
                    <a href="carrinho.html" class="cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <!-- HERO -->
    <section class="hero bg-biotech-2" style="min-height: 300px;">
        <div class="hero-content">
            <h1 style="font-size: 3rem;">Catálogo de Produtos</h1>
            <p>Explore nossa linha completa de peptídios de alta performance</p>
        </div>
    </section>

    <!-- CATÁLOGO -->
    <section class="container">
        <!-- FILTROS -->
        <div class="filtros">
            <div class="filtros-grid">
                <div class="filtro-group">
                    <label for="busca">
                        <i class="fas fa-search"></i> Buscar Produto
                    </label>
                    <input type="text" id="busca" placeholder="Digite o nome do produto...">
                </div>

                <div class="filtro-group">
                    <label for="categoria">
                        <i class="fas fa-filter"></i> Categoria
                    </label>
                    <select id="categoria">
                        <option value="">Todas as Categorias</option>
                        <option value="emagrecimento">Emagrecimento</option>
                        <option value="articulacao">Articulação</option>
                        <option value="performance">Performance Muscular</option>
                        <option value="imunidade">Imunidade</option>
                        <option value="nootropicos">Nootrópicos</option>
                        <option value="miostatina">Inibidor Miostatina</option>
                        <option value="antiaging">Anti-Aging</option>
                        <option value="pos-ciclo">Terapia Pós Ciclo</option>
                        <option value="libido">Libido Sexual</option>
                        <option value="suplementos">Suplementos</option>
                    </select>
                </div>

                <div class="filtro-group">
                    <label for="ordenar">
                        <i class="fas fa-sort"></i> Ordenar Por
                    </label>
                    <select id="ordenar">
                        <option value="nome">Nome (A-Z)</option>
                        <option value="preco-asc">Menor Preço</option>
                        <option value="preco-desc">Maior Preço</option>
                        <option value="destaque">Mais Populares</option>
                    </select>
                </div>

                <div class="filtro-group">
                    <button class="btn btn-primary" onclick="aplicarFiltros()" style="width: 100%; margin-top: 1.5rem;">
                        <i class="fas fa-filter"></i>
                        Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>

        <!-- RESULTADOS -->
        <div style="margin-bottom: 2rem;">
            <h3 style="color: var(--text-secondary);">
                <span id="totalProdutos">0</span> produtos encontrados
            </h3>
        </div>

        <!-- GRID DE PRODUTOS -->
        <div class="produto-grid" id="produtosGrid">
            <!-- Produtos serão carregados aqui -->
        </div>

        <!-- LOADING -->
        <div id="loading" style="text-align: center; padding: 3rem; display: none;">
            <div class="loading" style="margin: 0 auto;"></div>
            <p style="margin-top: 1rem; color: var(--text-secondary);">Carregando produtos...</p>
        </div>

        <!-- VAZIO -->
        <div id="vazio" style="text-align: center; padding: 3rem; display: none;">
            <i class="fas fa-box-open" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-secondary);">Nenhum produto encontrado</h3>
            <p style="color: var(--text-muted);">Tente ajustar os filtros de busca</p>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Only Pharma</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Peptídios de alta qualidade produzidos em Toronto, Canadá.
                </p>
                <div class="contact-info">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Toronto, Canada</span>
                </div>
            </div>

            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="index.html">Início</a></li>
                    <li><a href="produtos.html">Produtos</a></li>
                    <li><a href="blog.html">Blog & Depoimentos</a></li>
                    <li><a href="cadastro.html">Cadastre-se</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Contato</h3>
                <div class="contact-info">
                    <i class="fab fa-whatsapp"></i>
                    <a href="https://wa.me/5565998074000" target="_blank">+55 65 99807-4000</a>
                </div>
                <div class="contact-info">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:onlyzlucas@gmail.com">onlyzlucas@gmail.com</a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Only Pharma. Produzido em Toronto, Canada. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script>
        let todosProdutos = [];

        // Categorias Map
        const categoriasNomes = {
            'emagrecimento': 'Emagrecimento',
            'articulacao': 'Articulação',
            'performance': 'Performance Muscular',
            'imunidade': 'Imunidade',
            'nootropicos': 'Nootrópicos',
            'miostatina': 'Inibidor Miostatina',
            'antiaging': 'Anti-Aging',
            'pos-ciclo': 'Terapia Pós Ciclo',
            'libido': 'Libido Sexual',
            'suplementos': 'Suplementos'
        };

        // Carregar produtos
        async function carregarProdutos() {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('produtosGrid');
            
            loading.style.display = 'block';
            grid.innerHTML = '';

            try {
                const response = await fetch('tables/produtos?limit=100');
                const data = await response.json();
                todosProdutos = data.data;
                
                aplicarFiltros();
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                grid.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">Erro ao carregar produtos. Tente novamente.</p>';
            } finally {
                loading.style.display = 'none';
            }
        }

        // Aplicar filtros
        function aplicarFiltros() {
            const busca = document.getElementById('busca').value.toLowerCase();
            const categoria = document.getElementById('categoria').value;
            const ordenar = document.getElementById('ordenar').value;

            let produtosFiltrados = [...todosProdutos];

            // Filtro de busca
            if (busca) {
                produtosFiltrados = produtosFiltrados.filter(p => 
                    p.nome.toLowerCase().includes(busca) || 
                    p.descricao_curta.toLowerCase().includes(busca)
                );
            }

            // Filtro de categoria
            if (categoria) {
                produtosFiltrados = produtosFiltrados.filter(p => p.categoria_id === categoria);
            }

            // Ordenação
            switch(ordenar) {
                case 'nome':
                    produtosFiltrados.sort((a, b) => a.nome.localeCompare(b.nome));
                    break;
                case 'preco-asc':
                    produtosFiltrados.sort((a, b) => a.preco - b.preco);
                    break;
                case 'preco-desc':
                    produtosFiltrados.sort((a, b) => b.preco - a.preco);
                    break;
                case 'destaque':
                    produtosFiltrados.sort((a, b) => (b.destaque ? 1 : 0) - (a.destaque ? 1 : 0));
                    break;
            }

            exibirProdutos(produtosFiltrados);
        }

        // Exibir produtos
        function exibirProdutos(produtos) {
            const grid = document.getElementById('produtosGrid');
            const vazio = document.getElementById('vazio');
            const total = document.getElementById('totalProdutos');

            total.textContent = produtos.length;

            if (produtos.length === 0) {
                grid.innerHTML = '';
                vazio.style.display = 'block';
                return;
            }

            vazio.style.display = 'none';
            grid.innerHTML = produtos.map(produto => `
                <div class="produto-card fade-in">
                    ${produto.destaque ? '<div class="produto-badge">DESTAQUE</div>' : ''}
                    <img src="${produto.imagem}" alt="${produto.nome}" class="produto-img" 
                         onerror="this.src='https://via.placeholder.com/300x250/8b5cf6/ffffff?text=Only+Pharma'">
                    <div class="produto-info">
                        <div class="produto-categoria">${categoriasNomes[produto.categoria_id] || 'Produto'}</div>
                        <h3 class="produto-nome">${produto.nome}</h3>
                        <p class="produto-descricao">${produto.descricao_curta}</p>
                        <div class="produto-preco">R$ ${produto.preco.toFixed(2)}</div>
                        <div class="produto-acoes">
                            <button class="btn-card btn-add-cart" onclick="adicionarAoCarrinho('${produto.id}')">
                                <i class="fas fa-cart-plus"></i>
                                Adicionar
                            </button>
                            <a href="produto.html?id=${produto.id}" class="btn-card btn-ver-mais">
                                <i class="fas fa-info-circle"></i>
                                Ver Mais
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Adicionar ao carrinho
        function adicionarAoCarrinho(produtoId) {
            let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            const existe = carrinho.find(item => item.id === produtoId);
            
            if (existe) {
                existe.quantidade++;
            } else {
                carrinho.push({ id: produtoId, quantidade: 1 });
            }
            
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            atualizarContadorCarrinho();
            
            // Feedback
            const btn = event.target.closest('button');
            const textoOriginal = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Adicionado!';
            btn.style.background = 'var(--green)';
            
            setTimeout(() => {
                btn.innerHTML = textoOriginal;
                btn.style.background = '';
            }, 2000);
        }

        // Atualizar contador
        function atualizarContadorCarrinho() {
            const carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
            const total = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
            document.getElementById('cartCount').textContent = total;
        }

        // Aplicar filtros em tempo real
        document.getElementById('busca').addEventListener('input', aplicarFiltros);
        document.getElementById('categoria').addEventListener('change', aplicarFiltros);
        document.getElementById('ordenar').addEventListener('change', aplicarFiltros);

        // Verificar parâmetros URL
        const urlParams = new URLSearchParams(window.location.search);
        const categoriaUrl = urlParams.get('categoria');
        if (categoriaUrl) {
            document.getElementById('categoria').value = categoriaUrl;
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            carregarProdutos();
            atualizarContadorCarrinho();
        });
    </script>
</body>
</html>
